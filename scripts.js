window.addEventListener('load',()=>{setTimeout(()=>{document.getElementById('loadingScreen').classList.add('hidden')},800)});const canvas=document.getElementById('networkCanvas'),ctx=canvas.getContext('2d');canvas.width=window.innerWidth;canvas.height=window.innerHeight;const nodes=[],nodeCount=30,maxDistance=150;class Node{constructor(){this.x=Math.random()*canvas.width;this.y=Math.random()*canvas.height;this.vx=(Math.random()-.5)*.5;this.vy=(Math.random()-.5)*.5;this.radius=Math.random()*2+1}update(){this.x+=this.vx;this.y+=this.vy;if(this.x<0||this.x>canvas.width)this.vx*=-1;if(this.y<0||this.y>canvas.height)this.vy*=-1}draw(){ctx.beginPath();ctx.arc(this.x,this.y,this.radius,0,Math.PI*2);ctx.fillStyle='rgba(30, 58, 138, 0.5)';ctx.fill()}}function initNetwork(){for(let i=0;i<nodeCount;i++)nodes.push(new Node)}function drawConnections(){for(let i=0;i<nodes.length;i++)for(let j=i+1;j<nodes.length;j++){const dx=nodes[i].x-nodes[j].x,dy=nodes[i].y-nodes[j].y,distance=Math.sqrt(dx*dx+dy*dy);if(distance<maxDistance){ctx.beginPath();ctx.moveTo(nodes[i].x,nodes[i].y);ctx.lineTo(nodes[j].x,nodes[j].y);const opacity=(1-distance/maxDistance)*.3;ctx.strokeStyle=`rgba(212, 175, 55, ${opacity})`;ctx.lineWidth=1;ctx.stroke()}}}function animateNetwork(){ctx.clearRect(0,0,canvas.width,canvas.height);nodes.forEach(node=>{node.update();node.draw()});drawConnections();requestAnimationFrame(animateNetwork)}initNetwork();animateNetwork();window.addEventListener('resize',()=>{canvas.width=window.innerWidth;canvas.height=window.innerHeight;nodes.length=0;initNetwork()});let currentLang=localStorage.getItem('language')||'fa',typewriterTexts=[],textIndex=0,charIndex=0,isDeleting=!1;function changeLanguage(lang){currentLang=lang;localStorage.setItem('language',lang);const content=SITE_CONTENT[lang];document.documentElement.lang=content.lang;document.documentElement.dir=content.dir;document.body.setAttribute('dir',content.dir);if(typeof window.updateChatLanguage==='function')window.updateChatLanguage(lang);document.querySelector('.loading-text').textContent=content.loading;document.querySelectorAll('.nav-text').forEach((el,i)=>{const keys=Object.keys(content.nav);el.textContent=content.nav[keys[i]]});document.querySelector('.hero-name-first').textContent=content.hero.firstName;document.querySelector('.hero-name-last').textContent=content.hero.lastName;document.querySelector('.contact-btn-text').textContent=content.hero.contactBtn;typewriterTexts=content.hero.titles;textIndex=0;charIndex=0;document.querySelector('.about-title-1').textContent=content.about.title1;document.querySelector('.about-title-2').textContent=content.about.title2;document.querySelector('.about-subtitle-1').textContent=content.about.subtitle1;document.querySelector('.about-subtitle-2').textContent=content.about.subtitle2;document.querySelector('.about-p1').textContent=content.about.p1;document.querySelector('.about-p2').textContent=content.about.p2;document.querySelector('.info-label-1').textContent=content.about.info.label1;document.querySelector('.info-value-1').textContent=content.about.info.value1;document.querySelector('.info-label-2').textContent=content.about.info.label2;document.querySelector('.info-value-2').textContent=content.about.info.value2;document.querySelector('.info-label-3').textContent=content.about.info.label3;document.querySelector('.info-value-3').textContent=content.about.info.value3;document.querySelector('.info-label-4').textContent=content.about.info.label4;document.querySelector('.info-value-4').textContent=content.about.info.value4;document.querySelector('.about-btn-text').textContent=content.about.btn;document.querySelector('.services-title-1').textContent=content.services.title1;document.querySelector('.services-title-2').textContent=content.services.title2;const servicesGrid=document.getElementById('servicesGrid');servicesGrid.innerHTML='';content.services.items.forEach(service=>{servicesGrid.innerHTML+=`<div class="service-card"><i class="fas ${service.icon} service-icon"></i><h3><span class="text-green">${service.title1}</span> <span class="text-black">${service.title2}</span></h3><p>${service.desc}</p></div>`});document.querySelector('.blog-title-1').textContent=content.blog.title1;document.querySelector('.blog-title-2').textContent=content.blog.title2;const blogGrid=document.getElementById('blogGrid');blogGrid.innerHTML='';content.blog.items.forEach(post=>{blogGrid.innerHTML+=`<div class="blog-card"><div class="blog-image-placeholder ${post.color}"><i class="fas ${post.icon}"></i></div><div class="blog-content"><h3><span class="text-green">${post.title1}</span> <span class="text-black">${post.title2}</span></h3><p>${post.desc}</p><a href="#" class="blog-btn"><i class="fas fa-arrow-left"></i>${post.btn}</a></div></div>`});document.querySelector('.contact-title-1').textContent=content.contact.title1;document.querySelector('.contact-title-2').textContent=content.contact.title2;document.querySelector('.contact-info-title').textContent=content.contact.infoTitle;document.querySelector('.contact-map-title').textContent=content.contact.mapTitle;const contactItems=document.getElementById('contactItems');contactItems.innerHTML='';content.contact.items.forEach(item=>{const iconClass=item.icon.startsWith('fab')?'fab':'fas';contactItems.innerHTML+=`<div class="contact-item"><div class="contact-icon ${item.platform}-icon"><i class="${iconClass} ${item.icon}"></i></div><div class="contact-details"><h4>${item.title}</h4>${item.platform==='location'||item.platform==='rubika'?`<p>${item.value}</p>`:`<a href="${item.platform==='email'?'mailto:'+item.value:'#'}" target="_blank" rel="noopener">${item.value}</a>`}</div></div>`});document.querySelectorAll('.lang-btn, .mobile-lang-btn').forEach(btn=>{btn.classList.toggle('active',btn.dataset.lang===lang)})}changeLanguage(currentLang);document.querySelectorAll('.lang-btn, .mobile-lang-btn').forEach(btn=>{btn.addEventListener('click',()=>{changeLanguage(btn.dataset.lang);document.getElementById('mobileNav').classList.remove('active')})});const typewriter=document.getElementById('typewriter');function type(){const currentText=typewriterTexts[textIndex];if(isDeleting){typewriter.textContent=currentText.substring(0,charIndex-1);charIndex--}else{typewriter.textContent=currentText.substring(0,charIndex+1);charIndex++}if(!isDeleting&&charIndex===currentText.length){setTimeout(()=>isDeleting=!0,2000)}else if(isDeleting&&charIndex===0){isDeleting=!1;textIndex=(textIndex+1)%typewriterTexts.length}setTimeout(type,isDeleting?50:100)}type();const navLinks=document.querySelectorAll('.nav-link'),sections=document.querySelectorAll('.section');navLinks.forEach(link=>{link.addEventListener('click',e=>{e.preventDefault();const targetSection=link.getAttribute('data-section');sections.forEach(section=>section.classList.remove('active'));navLinks.forEach(nav=>nav.classList.remove('active'));document.getElementById(targetSection).classList.add('active');link.classList.add('active');document.getElementById('mobileNav').classList.remove('active')})});document.getElementById('mobileMenuToggle').addEventListener('click',()=>{document.getElementById('mobileNav').classList.add('active')});document.getElementById('mobileNavClose').addEventListener('click',()=>{document.getElementById('mobileNav').classList.remove('active')});const mapIframe=document.querySelector('.map-container iframe'),contactSection=document.getElementById('contact'),observer=new IntersectionObserver(entries=>{entries.forEach(entry=>{if(entry.isIntersecting&&mapIframe.getAttribute('src')==='about:blank')mapIframe.setAttribute('src',mapIframe.getAttribute('data-src'))})});observer.observe(contactSection);document.body.addEventListener('touchmove',e=>{if(!e.target.closest('.contact-items')&&!e.target.closest('.about-content')&&!e.target.closest('.services-grid')&&!e.target.closest('.blog-grid')&&!e.target.closest('.contact-new-content'))e.preventDefault()},{passive:!1});document.body.addEventListener('wheel',e=>{if(!e.target.closest('.contact-items')&&!e.target.closest('.about-content')&&!e.target.closest('.services-grid')&&!e.target.closest('.blog-grid')&&!e.target.closest('.contact-new-content'))e.preventDefault()},{passive:!1});const chatTranslations={fa:{title:"Ø³Ù„Ø§Ù…! ðŸ‘‹",subtitle:"Ú†Ø·ÙˆØ± Ù…ÛŒâ€ŒØªÙˆÙ†Ù… Ú©Ù…Ú©ØªÙˆÙ† Ú©Ù†Ù…ØŸ",footer:"",getStarted:"Ø´Ø±ÙˆØ¹ Ú¯ÙØªÚ¯Ùˆ",inputPlaceholder:"Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯...",closeButtonTooltip:"Ø¨Ø³ØªÙ† Ú†Øª"},en:{title:"Hello! ðŸ‘‹",subtitle:"How can I help you?",footer:"",getStarted:"Start Chat",inputPlaceholder:"Type your message...",closeButtonTooltip:"Close Chat"},ar:{title:"Ù…Ø±Ø­Ø¨Ø§! ðŸ‘‹",subtitle:"ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒØŸ",footer:"",getStarted:"Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©",inputPlaceholder:"Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ...",closeButtonTooltip:"Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©"}};window.addEventListener('load',()=>{setTimeout(()=>{import('https://cdn.jsdelivr.net/npm/@n8n/chat/dist/chat.bundle.es.js').then(module=>{console.log('âœ… Chat module loaded');const currentLang=localStorage.getItem('language')||'fa';module.createChat({webhookUrl:'https://ai.goldrang.ir/webhook/3e7c0813-7bfe-474d-8211-92fd736d3ab0/chat',mode:'window',showWelcomeScreen:!1,initialMessages:[],i18n:{en:chatTranslations[currentLang]}});console.log('âœ… Chat created');setTimeout(()=>{const toggle=document.querySelector('.chat-window-toggle');if(toggle){window.chatToggleButton=toggle;console.log('âœ… Toggle button ready')}const chatWrapper=document.querySelector('.chat-window-wrapper.n8n-chat');if(chatWrapper){chatWrapper.classList.add('chat-loaded');console.log('âœ… Chat visible')}},2000)}).catch(err=>{console.error('âŒ Error loading chat:',err)})},1000)});window.updateChatLanguage=function(lang){console.log('ðŸŒ Updating chat language to:',lang);if(!chatTranslations[lang]){console.warn('âš ï¸ Language not supported:',lang);return}setTimeout(()=>{const chatTitle=document.querySelector('.chat-heading h1'),chatSubtitle=document.querySelector('.chat-heading p'),chatInput=document.querySelector('.chat-input input, .chat-input textarea');if(chatTitle)chatTitle.textContent=chatTranslations[lang].title;if(chatSubtitle)chatSubtitle.textContent=chatTranslations[lang].subtitle;if(chatInput)chatInput.placeholder=chatTranslations[lang].inputPlaceholder;console.log('âœ… Chat language updated')},200)};window.addEventListener('load',()=>{setTimeout(()=>{const btn=document.getElementById('openChatBtn');if(!btn){console.error('âŒ Button not found');return}btn.addEventListener('click',e=>{e.preventDefault();console.log('ðŸ”µ Opening chat...');setTimeout(()=>{const toggle=window.chatToggleButton||document.querySelector('.chat-window-toggle');if(toggle){toggle.click();console.log('âœ… Chat opened')}else{const chatWindow=document.querySelector('.chat-window');if(chatWindow){chatWindow.style.display='flex';console.log('âœ… Chat opened (CSS)')}}},100)});console.log('âœ… Button connected')},2000)});